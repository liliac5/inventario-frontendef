<div class="inventario-container">
  <app-sidebar></app-sidebar>

  <div class="main-content">
    <div class="header">
      <h1 class="welcome">
        隆Bienvenido/a, <span class="user-name">{{ currentUser }}</span>!
      </h1>
    </div>

    <div class="content-area">
      <h2 class="page-title">INVENTARIO</h2>

      <!-- TARJETAS RESUMEN -->
      <div class="summary-cards">
        <div class="summary-card">
          <div class="card-number">{{ totalBienes || 0 }}</div>
          <div class="card-label">TOTAL BIENES</div>
        </div>
        <div class="summary-card">
          <div class="card-number">{{ totalCategorias || 0 }}</div>
          <div class="card-label">CATEGORAS</div>
        </div>
        <div class="summary-card">
          <div class="card-number">{{ bienesDisponibles || 0 }}</div>
          <div class="card-label">BIENES DISPONIBLES</div>
        </div>
        <div class="summary-card">
          <div class="card-number">{{ bienesAsignados || 0 }}</div>
          <div class="card-label">BIENES ASIGNADOS</div>
        </div>
      </div>

      <!-- ACCIONES -->
      <div class="actions-bar">
        <input
          type="text"
          class="search-input"
          placeholder="BUSCAR POR CDIGO..."
          [(ngModel)]="searchTerm"
          name="searchTerm"
          (input)="onSearch()"
        />

        <button class="add-button" type="button" (click)="openAddModal()">
          A帽adir Nuevo Bien
        </button>

        <button class="category-button" type="button" (click)="openCategoryModal()">
          Nueva Categor铆a
        </button>

        <div class="filter-dropdown-wrapper">
          <button class="show-all-button" type="button" (click)="toggleFilterDropdown()">
            {{ selectedFilter }}
          </button>

          <div class="filter-dropdown" *ngIf="showFilterDropdown">
            <button
              *ngFor="let option of filterOptions"
              type="button"
              class="filter-option"
              (click)="selectFilter(option)">
              {{ option }}
            </button>
          </div>
        </div>
      </div>

      <!-- TABLA -->
      <div class="table-container">
        <table class="inventario-table">
          <thead>
            <tr>
              <th>CDIGO</th>
              <th>NOMBRE</th>
              <th>CATEGORA</th>
              <th>TIPO</th>
              <th>UBICACIN</th>
              <th>AULA</th>
              <th>ESTADO</th>
              <th>VALOR</th>
              <th>ACCIONES</th>
            </tr>
          </thead>

        <tbody>
  <tr *ngFor="let bien of filteredBienes">
    <td>{{ bien.codigoBien }}</td>
    <td>{{ bien.nombreBien }}</td>
    <td>{{ bien.categoria?.nombre || 'Sin categor铆a' }}</td>
    <td>{{ bien.tipoBien }}</td>
    <td>{{ bien.ubicacion }}</td>
    <td>{{ bien.aula?.nombre || 'Sin asignar' }}</td>

    <td>
      <span class="status-badge">{{ bien.estado }}</span>
    </td>

    <td>
      ${{ bien.valorCompraInicial | number:'1.2-2' }}
    </td>

    <td>
      <button class="action-btn view-btn" (click)="openEditModal(bien)">锔</button>
      <button class="action-btn delete-btn" (click)="deleteBien(bien)"></button>
    </td>
  </tr>

  <tr *ngIf="filteredBienes.length === 0">
    <td colspan="8" class="no-data">No hay bienes registrados</td>
  </tr>
</tbody>

        </table>
      </div>
    </div>
  </div>
</div>

<!-- MODAL CREAR BIEN -->
<div class="modal-overlay" *ngIf="showAddModal">
  <div class="modal-content large-modal">

    <h2>Registrar Bien</h2>

    <form class="modal-form grid-form" (ngSubmit)="saveBien()">

      <!-- C贸digo -->
      <div class="form-field">
        <label>C贸digo del bien</label>
        <input type="text" [(ngModel)]="nuevoBien.codigoBien"
               name="codigoBien" placeholder="BIEN-001" required>
      </div>

      <!-- Nombre -->
      <div class="form-field">
        <label>Nombre del bien</label>
        <input type="text" [(ngModel)]="nuevoBien.nombreBien"
               name="nombreBien" placeholder="Laptop Dell" required>
      </div>

      <!-- Tipo -->
      <div class="form-field">
        <label>Tipo de bien</label>
        <input type="text" [(ngModel)]="nuevoBien.tipoBien"
               name="tipoBien" placeholder="Electr贸nico" required>
      </div>

      <!-- Clase -->
      <div class="form-field">
        <label>Clase del bien</label>
        <input type="text" [(ngModel)]="nuevoBien.claseBien"
               name="claseBien" placeholder="Activo fijo" required>
      </div>

      <!-- Cuenta -->
      <div class="form-field">
        <label>Cuenta tipo bien</label>
        <input type="text" [(ngModel)]="nuevoBien.cuentaTipoBien"
               name="cuentaTipoBien" placeholder="1.2.3.04" required>
      </div>

      <!-- Inventario -->
      <div class="form-field">
        <label>C贸digo inventario</label>
        <input type="text" [(ngModel)]="nuevoBien.codigoInventario"
               name="codigoInventario" placeholder="INV-2025-01" required>
      </div>

      <!-- SECAP -->
      <div class="form-field">
        <label>C贸digo SECAP</label>
        <input type="text" [(ngModel)]="nuevoBien.codigoSecap"
               name="codigoSecap" placeholder="SEC-8899" required>
      </div>

      <!-- Descripci贸n -->
      <div class="form-field full-width">
        <label>Descripci贸n</label>
        <textarea [(ngModel)]="nuevoBien.descripcion"
                  name="descripcion"
                  placeholder="Descripci贸n detallada del bien"
                  rows="3"></textarea>
      </div>

      <!-- Especificaciones -->
      <div class="form-field full-width">
        <label>Especificaciones</label>
        <textarea [(ngModel)]="nuevoBien.especificaciones"
                  name="especificaciones"
                  placeholder="Especificaciones t茅cnicas del bien"
                  rows="3"></textarea>
      </div>

      <!-- Marca -->
      <div class="form-field">
        <label>Marca</label>
        <input type="text" [(ngModel)]="nuevoBien.marca"
               name="marca" placeholder="Dell">
      </div>

      <!-- Modelo -->
      <div class="form-field">
        <label>Modelo</label>
        <input type="text" [(ngModel)]="nuevoBien.modelo"
               name="modelo" placeholder="Latitude 5420">
      </div>

      <!-- Serie -->
      <div class="form-field">
        <label>Serie</label>
        <input type="text" [(ngModel)]="nuevoBien.serie"
               name="serie" placeholder="SN123456">
      </div>

      <!-- Valores -->
      <div class="form-field">
        <label>Valor compra</label>
        <input type="number" [(ngModel)]="nuevoBien.valorCompraInicial"
               name="valorCompraInicial" placeholder="850" required>
      </div>

      <div class="form-field">
        <label>Valor con IVA</label>
        <input type="number" [(ngModel)]="nuevoBien.valorConIva"
               name="valorConIva" placeholder="952" required>
      </div>

      <!-- Estado -->
      <div class="form-field">
        <label>Estado</label>
        <select [(ngModel)]="nuevoBien.estado" name="estado" required>
          <option value="">Seleccione</option>
          <option>Disponible</option>
          <option>Asignado</option>
          <option>En Mantenimiento</option>
          <option>Da帽ado</option>
          <option>Baja</option>
        </select>
      </div>

      <!-- Detalle Estado -->
      <div class="form-field">
        <label>Detalle del Estado</label>
        <input type="text" [(ngModel)]="nuevoBien.detalleEstado"
               name="detalleEstado"
               placeholder="Detalle del estado actual">
      </div>

      <!-- Custodio -->
      <div class="form-field">
        <label>Custodio</label>
        <input type="text" [(ngModel)]="nuevoBien.custodio"
               name="custodio" placeholder="Juan P茅rez" required>
      </div>

      <!-- Ubicaci贸n -->
      <div class="form-field">
        <label>Ubicaci贸n</label>
        <input type="text" [(ngModel)]="nuevoBien.ubicacion"
               name="ubicacion" placeholder="Laboratorio 2" required>
      </div>

      <!-- Provincia -->
      <div class="form-field">
        <label>Provincia</label>
        <input type="text" [(ngModel)]="nuevoBien.provincia"
               name="provincia" placeholder="Pichincha" required>
      </div>

      <!-- Observaciones -->
      <div class="form-field full-width">
        <label>Observaciones</label>
        <textarea [(ngModel)]="nuevoBien.observaciones"
                  name="observaciones"
                  placeholder="Observaciones generales"
                  rows="3"></textarea>
      </div>

      <!-- Observaciones 2 -->
      <div class="form-field full-width">
        <label>Observaciones Adicionales</label>
        <textarea [(ngModel)]="nuevoBien.observaciones2"
                  name="observaciones2"
                  placeholder="Observaciones adicionales"
                  rows="3"></textarea>
      </div>

      <!-- Categor铆a -->
      <div class="form-field">
        <label>Categor铆a</label>
        <select [(ngModel)]="nuevoBien.idCategoria" name="categoria" required>
          <option [ngValue]="null">Seleccione una categor铆a</option>
          <option *ngFor="let c of categorias" [ngValue]="c.id_categoria">
            {{ c.nombre }}
          </option>
        </select>
      </div>

      <!-- Aula -->
      <div class="form-field">
        <label>Aula</label>
        <select [(ngModel)]="nuevoBien.idAula" name="idAula">
          <option [ngValue]="null">Seleccione un aula</option>
          <option *ngFor="let aula of aulas" [ngValue]="aula.idAula">
            {{ aula.nombre }} - {{ aula.ubicacion }}
          </option>
        </select>
      </div>

      <div class="modal-actions full-width">
        <button type="submit" class="btn-save">Guardar</button>
        <button type="button" class="btn-cancel" (click)="closeAddModal()">Cancelar</button>
      </div>

    </form>

  </div>
</div>



<!-- MODAL NUEVA CATEGORA -->
<!-- MODAL CREAR CATEGORA -->
<div class="modal-overlay" *ngIf="showCategoryModal">
  <div class="modal-content">

    <h2>Nueva Categor铆a</h2>

    <form class="modal-form" (ngSubmit)="saveCategoria()">

      <div class="form-field">
        <label>Nombre de la categor铆a</label>
        <input
          type="text"
          [(ngModel)]="nuevaCategoria.nombre"
          name="nombre"
          required
        />
      </div>

      <div class="form-field">
        <label>Descripci贸n</label>
        <textarea
          [(ngModel)]="nuevaCategoria.descripcion"
          name="descripcion">
        </textarea>
      </div>

      <div class="modal-actions">
        <button type="submit" class="btn-save" >Guardar</button>
        <button type="button" class="btn-cancel" (click)="closeCategoryModal()">Cancelar</button>
      </div>

    </form>

  </div>
</div>



<!-- MODAL EDITAR BIEN -->
<div class="modal-overlay" *ngIf="showDetailModal">
  <div class="modal-content large-modal">

    <h2>Editar Bien</h2>

    <form class="modal-form grid-form" (ngSubmit)="updateBien()">

      <div class="form-field">
        <label>C贸digo</label>
        <input type="text" [(ngModel)]="selectedBien.codigoBien"
               name="codigoBienEdit" required>
      </div>

      <div class="form-field">
        <label>Nombre</label>
        <input type="text" [(ngModel)]="selectedBien.nombreBien"
               name="nombreBienEdit" required>
      </div>

      <div class="form-field">
        <label>Tipo</label>
        <input type="text" [(ngModel)]="selectedBien.tipoBien"
               name="tipoBienEdit">
      </div>

      <div class="form-field">
        <label>Clase</label>
        <input type="text" [(ngModel)]="selectedBien.claseBien"
               name="claseBienEdit">
      </div>

      <div class="form-field">
        <label>Cuenta</label>
        <input type="text" [(ngModel)]="selectedBien.cuentaTipoBien"
               name="cuentaTipoBienEdit">
      </div>

      <div class="form-field">
        <label>Estado</label>
        <select [(ngModel)]="selectedBien.estado"
                name="estadoEdit">
          <option>Disponible</option>
          <option>Asignado</option>
          <option>En Mantenimiento</option>
          <option>Da帽ado</option>
          <option>Baja</option>
        </select>
      </div>

      <div class="form-field">
        <label>Ubicaci贸n</label>
        <input type="text" [(ngModel)]="selectedBien.ubicacion"
               name="ubicacionEdit">
      </div>

      <div class="form-field">
        <label>Provincia</label>
        <input type="text" [(ngModel)]="selectedBien.provincia"
               name="provinciaEdit">
      </div>

      <div class="form-field">
        <label>Custodio</label>
        <input type="text" [(ngModel)]="selectedBien.custodio"
               name="custodioEdit">
      </div>

      <div class="form-field">
        <label>Valor compra</label>
        <input type="number"
               [(ngModel)]="selectedBien.valorCompraInicial"
               name="valorCompraEdit">
      </div>

      <div class="form-field">
        <label>Valor con IVA</label>
        <input type="number"
               [(ngModel)]="selectedBien.valorConIva"
               name="valorConIvaEdit">
      </div>

      <div class="form-field">
  <label>Aula</label>
 <select
  [(ngModel)]="selectedBien.aula.idAula"
  name="aulaEdit">
  <option [ngValue]="null">Seleccione aula</option>
  <option *ngFor="let a of aulas" [ngValue]="a.idAula">
    {{ a.nombre }}
  </option>
</select>
</div>

      <div class="form-field full-width">
        <label>Observaciones</label>
        <textarea [(ngModel)]="selectedBien.observaciones"
                  name="observacionesEdit"></textarea>
      </div>

      <div class="modal-actions full-width">
        <button type="submit" class="btn-save" >Guardar cambios</button>
        <button type="button"class="btn-cancel" (click)="closeDetailModal()">Cancelar</button>
      </div>

    </form>
  </div>
</div>
